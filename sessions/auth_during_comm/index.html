<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ID-Contact Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ID-Contact Blog Atom Feed"><title data-react-helmet="true">Authenticating during a communication session | ID-Contact</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Authenticating during a communication session | ID-Contact"><meta data-react-helmet="true" name="description" content="There may be circumstances where there is a need to authenticate an end user when they are already in a communication session. This is supported by ID Contact using the authentication during communication flow. Such a flow has two major differences to a regular flow:"><meta data-react-helmet="true" property="og:description" content="There may be circumstances where there is a need to authenticate an end user when they are already in a communication session. This is supported by ID Contact using the authentication during communication flow. Such a flow has two major differences to a regular flow:"><meta data-react-helmet="true" property="og:url" content="https://docs.idcontact.nl/sessions/auth_during_comm"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.idcontact.nl/sessions/auth_during_comm"><link rel="stylesheet" href="/styles.d37612c9.css">
<link rel="preload" href="/styles.86abdcb7.js" as="script">
<link rel="preload" href="/runtime~main.61a81c9d.js" as="script">
<link rel="preload" href="/main.f777b766.js" as="script">
<link rel="preload" href="/2.0732aa58.js" as="script">
<link rel="preload" href="/3.71af52dc.js" as="script">
<link rel="preload" href="/27.af86968c.js" as="script">
<link rel="preload" href="/935f2afb.fed1a0dc.js" as="script">
<link rel="preload" href="/17896441.30863bfd.js" as="script">
<link rel="preload" href="/68c0bb61.6e85a316.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">ID-Contact</strong></a><a class="navbar__item navbar__link" href="/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">ID-Contact</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Docs</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">ID Contact</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/concepts/attributes">Attributes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/concepts/purposes">Purposes</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Sessions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sessions/full">Full</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/sessions/auth_during_comm">Authentication during communication</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/core_api">Core API</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Authentication Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/auth/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/auth/tech_example">Sample interaction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/auth/api">API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Communication Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comm/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comm/tech_example">Sample interaction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/comm/api">API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Sample Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sample_plugins/amazon_connect">Amazon Connect (telephony)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sample_plugins/digid">DigiD</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/setup">Local testing setup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">ID Contact configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/configuration/core">Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/configuration/auth_test">Authentication test plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/configuration/comm_test">Communication test plugin</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Authenticating during a communication session</h1></header><div class="markdown"><p>There may be circumstances where there is a need to authenticate an end user when they are already in a communication session. This is supported by ID Contact using the authentication during communication flow. Such a flow has two major differences to a regular flow:</p><ol><li>The communication plugin, rather than an external initiator, is responsible for working with the core to initiate the authentication.</li><li>The ID Contact core does not separately call the communication plugin to setup a new communication session, instead using information provided during the start request</li></ol><p>This document will be devoted primarily to describing the responsibilities of the communication plugin as initiator in this flow. Details on the regular plugin interactions in ID Contact sessions can be found in the <a href="/comm/overview">communication plugin</a> and the <a href="/auth/overview">authentication plugin</a> documentation. For context on how a full ID Contact session is initiated, see the <a href="/sessions/full">full session documentation</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="session-overview"></a>Session overview<a class="hash-link" href="#session-overview" title="Direct link to heading">#</a></h2><p>An authentication during communication session consists of 4 steps:</p><ol><li>Unauthenticated communication</li><li>End user choice gathering and initiation of authentication</li><li>Authentication</li><li>Resumption of communication</li></ol><p>Steps 1, 3 and 4 are mostly plugin specific, and any generic parts are covered elsewhere in this documentation. Here, we will focus on the actions of the communication plugin needed during step 2. During this step, the communication plugin fetches the available authentication options, lets the user choose one of these, and then signals the core with the necessary information to start authentication. Finally, it redirects the end user to the starting point of the authentication flow.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="requesting-authentication-options"></a>Requesting authentication options<a class="hash-link" href="#requesting-authentication-options" title="Direct link to heading">#</a></h2><p>At the start of step 2, the communication plugin needs to fetch a list of authentication options for the current purpose. For this, the plugin can use the core&#x27;s <a href="/core_api"><code>session_options</code> endpoint</a>. For example, if the indicated purpose were <code>personal_question</code>, the initiator would send a get request:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-http codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GET /session_options/personal_question HTTP/1.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Host: core:8000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Connection: close</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">accept: */*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">accept-encoding: gzip, deflate, br</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">accept-language: en-US,en;q=0.9</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And get a response similar to</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-http codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">HTTP/1.0 200 OK</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">content-type: application/json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">server: Rocket</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">content-length: 288</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">date: Thu, 01 Jul 2021 08:27:43 GMT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;auth_methods&quot;:[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tag&quot;:&quot;irma&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;:&quot;IRMA&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;image_path&quot;:&quot;/static/irma.svg&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tag&quot;:&quot;digid&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;:&quot;DigiD&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;image_path&quot;:&quot;/static/digid.svg&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;comm_methods&quot;:[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tag&quot;:&quot;call&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;:&quot;Call&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;image_path&quot;:&quot;/static/phone.svg&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;tag&quot;:&quot;chat&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;:&quot;Chat&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;image_path&quot;:&quot;/static/chat.svg&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>For an authentication during communication session, the communication plugin can disregard the <code>comm_methods</code> information provided.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="initiating-authentication"></a>Initiating authentication<a class="hash-link" href="#initiating-authentication" title="Direct link to heading">#</a></h2><p>Once the end user has chosen the method of authentication, the communication plugin can initiate the authentication using the core&#x27;s <a href="/core_api"><code>start</code> endpoint</a>. Rather than specifying the communication method as a tag, the communication plugin indicates that it already has a communication session by directly providing a <code>comm_url</code> at which the communication can be resumed after authentication, and, if desired, a separate <code>attr_url</code> at which the authentication results should be provided.</p><p>Continuing the above example, assuming the end user has chosen <code>irma</code> as authentication method, that communication should be resumed at <code>https://example.com/chat</code> and that the attributes should be sent to <code>https://example.com/attributes/a12345</code>. Then the communication plugin will make a request similar to</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-http codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">POST /start HTTP/1.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Host: core:8000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Connection: close</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Content-Length: 73</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">accept: application/json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">content-type: application/json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">accept-encoding: gzip, deflate, br</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">accept-language: en-US,en;q=0.9</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;auth_method&quot;:&quot;irma&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;purpose&quot;:&quot;personal_question&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;comm_url&quot;:&quot;https://example.com/chat&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;attr_url&quot;:&quot;https://example.com/attributes/a12345&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>and will get a response similar to</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">HTTP/1.0 200 OK</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">content-type: application/json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">server: Rocket</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">content-length: 388</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">date: Thu, 01 Jul 2021 08:31:12 GMT</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;client_url&quot;:&quot;https://auth-irma.idcontact.test.tweede.golf/auth/eyJ1IjoiaHR0cHM6Ly9pcm1hLXNlcnZlci5pZGNvbnRhY3QudGVzdC50d2VlZGUuZ29sZi9pcm1hL3Nlc3Npb24vUmdxamZqVHdKNHpmNEJFTzJMZzMiLCJpcm1hcXIiOiJkaXNjbG9zaW5nIn0=/aHR0cHM6Ly93aWRnZXQuY29tbS1tYXRyaXguaWRjb250YWN0LnRlc3QudHdlZWRlLmdvbGYvP3Nlc3Npb249NWUwOTJmNGJmNDIyZDY1OWEyODU5MTVjMGU3Mjk1MWFmODA4MGZkOWVhNDI0YjIwZTgwOWNiMjRiMDI5NWE4Mw==&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>After this, the communication plugin should redirect the end user to the specified <code>client_url</code>. After authentication has completed the end user will be redirected to <code>http://example.com/</code> and the plugin will receive the attributes on <code>https://example.com/attributes/a12345</code> as documented in the <a href="/comm/overview">communication plugin documentation</a></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/sessions/full"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Full ID Contact session</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/core_api"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Core API Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#session-overview" class="table-of-contents__link">Session overview</a></li><li><a href="#requesting-authentication-options" class="table-of-contents__link">Requesting authentication options</a></li><li><a href="#initiating-authentication" class="table-of-contents__link">Initiating authentication</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/auth/overview">Authentication plugins</a></li><li class="footer__item"><a class="footer__link-item" href="/comm/overview">Communication plugins</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Tweede Golf. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.86abdcb7.js"></script>
<script src="/runtime~main.61a81c9d.js"></script>
<script src="/main.f777b766.js"></script>
<script src="/2.0732aa58.js"></script>
<script src="/3.71af52dc.js"></script>
<script src="/27.af86968c.js"></script>
<script src="/935f2afb.fed1a0dc.js"></script>
<script src="/17896441.30863bfd.js"></script>
<script src="/68c0bb61.6e85a316.js"></script>
</body>
</html>