(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{73:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return u}));var o=n(3),i=n(7),a=(n(0),n(85)),r={id:"tech_example",title:"Communication plugin sample interaction",sidebar_label:"Sample interaction",slug:"tech_example"},c={unversionedId:"comm/tech_example",id:"comm/tech_example",isDocsHomePage:!1,title:"Communication plugin sample interaction",description:"Below is an example of an entire communication interaction for a session involving the test communication plugin as communication plugin.",source:"@site/docs/comm/tech_example.md",slug:"/comm/tech_example",permalink:"/docs/comm/tech_example",version:"current",sidebar_label:"Sample interaction",sidebar:"docs",previous:{title:"Communication plugin overview",permalink:"/docs/comm/overview"},next:{title:"Communication plugin API",permalink:"/docs/comm/api"}},l=[{value:"Setup",id:"setup",children:[]},{value:"Initiation of communication",id:"initiation-of-communication",children:[]},{value:"Authentication result reception",id:"authentication-result-reception",children:[]}],s={toc:l};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Below is an example of an entire communication interaction for a session involving the test communication plugin as communication plugin."),Object(a.b)("h2",{id:"setup"},"Setup"),Object(a.b)("p",null,"For our communication plugin, a session starts with a request from the ID Contact core to setup a communication session:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-http"},'POST /start_communication HTTP/1.1\ncontent-type: application/json\naccept: */*\nhost: comm-test:8000\ncontent-length: 25\n\n{\n    "purpose": "report_move"\n}\n')),Object(a.b)("p",null,"Here, the core indicates to us that it wants to setup a session for the ",Object(a.b)("inlineCode",{parentName:"p"},"report_move")," purpose, and that it does not yet have any attributes for this session. After some setup, the communication plugin responds:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-http"},'HTTP/1.1 200 OK\ncontent-type: application/json\nserver: Rocket\ncontent-length: 110\ndate: Tue, 16 Mar 2021 07:30:00 GMT\n\n{\n    "client_url": "http://comm-test.idcontact.test.tweede.golf/ui",\n    "attr_url":   "http://comm-test:8000/auth_result"\n}\n')),Object(a.b)("p",null,"This response tells the core that, once ready, the end user needs to be sent to ",Object(a.b)("inlineCode",{parentName:"p"},"http://comm-test.id-contact.test.tweede.golf/ui")," to initiate the actual communication. Furthermore, we tell the core that we want to receive attributes separately on the internal ",Object(a.b)("inlineCode",{parentName:"p"},"http://comm-test:8000/auth_result")," url. For an actual communication plugin, you may want to include some form of session token or state allowing you to correlate these URLs to this request. As our test communication plugin does no correlation, that is not done here."),Object(a.b)("h2",{id:"initiation-of-communication"},"Initiation of communication"),Object(a.b)("p",null,"After setup, the communication plugin has no further jobs until the client gets redirected to it:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-http"},"GET /ui HTTP/1.0\nHost: comm-test:8000\nConnection: close\nupgrade-insecure-requests: 1\nuser-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36\naccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nsec-fetch-site: cross-site\nsec-fetch-mode: navigate\nsec-fetch-user: ?1\nsec-fetch-dest: document\naccept-encoding: gzip, deflate, br\naccept-language: en-US,en;q=0.9\n")),Object(a.b)("p",null,"At this point, we can take control of the end-users experience, and provide it with the communication UI needed:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-http"},"HTTP/1.0 200 OK\ncontent-type: text/plain; charset=utf-8\nserver: Rocket\ncontent-length: 23\ndate: Tue, 16 Mar 2021 07:30:00 GMT\n\nCommunication plugin UI\n")),Object(a.b)("h2",{id:"authentication-result-reception"},"Authentication result reception"),Object(a.b)("p",null,"Simultaneously, we also receive authentication session result to the ",Object(a.b)("inlineCode",{parentName:"p"},"attr_url")," provided during setup:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-http"},"POST /auth_result HTTP/1.1\ncontent-type: application/jwt\naccept: */*\nhost: comm-test:8000\ncontent-length: 1202\n\neyJ0eXAiOiJKV1QiLCJjdHkiOiJKV1QiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiYWxnIjoiUlNBLU9BRVAifQ.j9ANvlSvi8AjqQ2NjX0OpqZvmL5pG4kH8O6BEtoui4KukDn2nIfgiGNV7fR3rmWrvZJ2E5qOoNQy6TMYsQYvdA4gdQkQd8VqkXIHGH0AFTBDnTtAVPuAc9iTFiJ5KZzUd_kTDkhrIyX4aWGjhwR4jk7gGdTlXMnR-tK2K9n5C6XTiuM-i-D39lSpsujQmkHzkmGkoqpNRYpulEUphLoov9U0C1yCHO0ZGR1SeWIM0STyh6H0cUPZEWneNOQsVeWGGDAOe1l7EHznr2CP8i_lXCIiSj4hJ8bB5ZxjbOeTYj8XMt7SpTTBAHuFerO6SqCLXa89rHymNgIA12itxrNDAg.BsX5IzSKDzvKz36VOs74wQ.R89gy8vBW0rwslJblj4uQYV-3eP9N_aOxeE23rxA44uxDFF-Q0VyFv-G1TWHVnhJvsw8qoX8JaG8IXr4VK_m7TbJmL6KMA2-_BD8kO-DHQJc4_d6sS-BZ4YYuPjJnSuAoN7znwFdiyyjdq34r8drOBnL2rroPRR62_QkXc4LZBYAWgRQNLoaZmUVsnIFekhSo2wPoODpTP5AJOzfbHXMOMThnW86Mgyc6eM2kvojjnTqsnL3Wt2NZS0ubfzJ8C5nYuGFnfaLUoLUhnYnNGksmInX_2Vb92Ddn5lkOROVaoE-31pZaKffkCyjSks9vpZ-bZPnTvBZfZ6eMK2G1oyeuL4awIJNXI0aR0pW7HREhm6S6nsp7HANtPnUfy2ZdAmTTKP8SSoXVRQHkEZODgGq38rBD2OpjFwQepmqY-Ie5cHAWXw-k3pnnxon45TUXrJh3x3MUdPETSHEoUtpzbueOXtqXjeHtVK8OjU7K25qc7TdcpFtMdo5uZ22KcNVXBjZvxXEigzrumUgOcc8Z5oHo7bujjvgWwuZNv4TppJs2Q6YVb-_AaKWM02WhCDQoMiiaGBbaV-2oifAmzkfw-14DOkzJ-eoZl3JLn7IP0rST2pS_iLztl_QQCynMrN6r0ipm8-XCQU2pOwLGlNOd6_usy0vy1zhck2UQVECz4ZoIJ5WwSdmP6-Iwn21vsxNm6_FFrdYIt7Buu8JGMLLBEfzSg.hCcQGm2i-px5kW2UzPhmkQ\n")),Object(a.b)("p",null,"The content here is a JWT containing the authentication result. This consists of two layers. The outer layer, seen above, is a JWE containg another JWT as payload in the following manner:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n    "typ": "JWT",\n    "cty": "JWT",\n    "enc": "A128CBC-HS256",\n    "alg": "RSA-OAEP"\n}\n.\n{\n    "njwt": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJpZC1jb250YWN0LWF0dHJpYnV0ZXMiLCJzdGF0dXMiOiJzdWNjZXMiLCJhdHRyaWJ1dGVzIjp7ImVtYWlsIjoiYmxhIn0sImlhdCI6MTYxNTg3OTgwMCwiZXhwIjoxNjE1ODgwMTAwfQ.T4VliaytEhlf2PwOiKL0GY4IcmXd64A8Gl2P9w6Tl1mQzzAqnF8TV7IjrUSu3tvs1hAS3gR-WqAhxSKzv0WuzrewXv_uvkdabJ4HTTRsALbUk13jt1C4A5wCR-3tP4H6sV5M5ODdT83wFb1_huoU_GtnXCVdQwmQMtO5wteMA_XOHEv6ExCaBKPr8NQ6Txd5SHsUG48gZfWmSDSYB9mzD99CdfEQUxebvQ9x3hUQffRsIsE6MqNakD8h0W8qlabnPxZ2fe7Tn8AlZzTFNu3EW35JdvENJQ2r71QxJOdEVHxoBREBlFGpCAjXH1x6aRWi_GfUD8s5zEkB_xA1_InesQ"\n}\n')),Object(a.b)("p",null,"The inner JWS ",Object(a.b)("inlineCode",{parentName:"p"},"njwt")," contains the actual authentication result:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n    "typ": "JWT",\n    "alg": "RS256"\n}\n.\n{\n    "sub":"id-contact-attributes",\n    "status":"succes",\n    "attributes": {\n        "email": "bla"\n    },\n    "iat": 1615879800,\n    "exp": 1615880100\n}\n')))}u.isMDXComponent=!0},85:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var o=n(0),i=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),u=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=u(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,r=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=u(n),b=o,d=p["".concat(r,".").concat(b)]||p[b]||m[b]||a;return n?i.a.createElement(d,c(c({ref:t},s),{},{components:n})):i.a.createElement(d,c({ref:t},s))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=b;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:o,r[1]=c;for(var s=2;s<a;s++)r[s]=n[s];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);