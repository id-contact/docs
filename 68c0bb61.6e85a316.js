(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{80:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return r})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return l}));var i=n(3),a=n(7),o=(n(0),n(94)),c={id:"auth_during_comm",title:"Authenticating during a communication session",sidebar_label:"Authentication during communication",slug:"auth_during_comm"},r={unversionedId:"sessions/auth_during_comm",id:"sessions/auth_during_comm",isDocsHomePage:!1,title:"Authenticating during a communication session",description:"There may be circumstances where there is a need to authenticate an end user when they are already in a communication session. This is supported by ID Contact using the authentication during communication flow. Such a flow has two major differences to a regular flow:",source:"@site/docs/sessions/auth_during_comm.md",slug:"/sessions/auth_during_comm",permalink:"/sessions/auth_during_comm",version:"current",sidebar_label:"Authentication during communication",sidebar:"docs",previous:{title:"Full ID Contact session",permalink:"/sessions/full"},next:{title:"Core API",permalink:"/core_api"}},s=[{value:"Session overview",id:"session-overview",children:[]},{value:"Requesting authentication options",id:"requesting-authentication-options",children:[]},{value:"Initiating authentication",id:"initiating-authentication",children:[]}],u={toc:s};function l(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(i.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"There may be circumstances where there is a need to authenticate an end user when they are already in a communication session. This is supported by ID Contact using the authentication during communication flow. Such a flow has two major differences to a regular flow:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"The communication plugin, rather than an external initiator, is responsible for working with the core to initiate the authentication."),Object(o.b)("li",{parentName:"ol"},"The ID Contact core does not separately call the communication plugin to setup a new communication session, instead using information provided during the start request")),Object(o.b)("p",null,"This document will be devoted primarily to describing the responsibilities of the communication plugin as initiator in this flow. Details on the regular plugin interactions in ID Contact sessions can be found in the ",Object(o.b)("a",{parentName:"p",href:"/comm/overview"},"communication plugin")," and the ",Object(o.b)("a",{parentName:"p",href:"/auth/overview"},"authentication plugin")," documentation. For context on how a full ID Contact session is initiated, see the ",Object(o.b)("a",{parentName:"p",href:"./full"},"full session documentation")),Object(o.b)("h2",{id:"session-overview"},"Session overview"),Object(o.b)("p",null,"An authentication during communication session consists of 4 steps:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Unauthenticated communication"),Object(o.b)("li",{parentName:"ol"},"End user choice gathering and initiation of authentication"),Object(o.b)("li",{parentName:"ol"},"Authentication"),Object(o.b)("li",{parentName:"ol"},"Resumption of communication")),Object(o.b)("p",null,"Steps 1, 3 and 4 are mostly plugin specific, and any generic parts are covered elsewhere in this documentation. Here, we will focus on the actions of the communication plugin needed during step 2. During this step, the communication plugin fetches the available authentication options, lets the user choose one of these, and then signals the core with the necessary information to start authentication. Finally, it redirects the end user to the starting point of the authentication flow."),Object(o.b)("h2",{id:"requesting-authentication-options"},"Requesting authentication options"),Object(o.b)("p",null,"At the start of step 2, the communication plugin needs to fetch a list of authentication options for the current purpose. For this, the plugin can use the core's ",Object(o.b)("a",{parentName:"p",href:"../core_api"},Object(o.b)("inlineCode",{parentName:"a"},"session_options")," endpoint"),". For example, if the indicated purpose were ",Object(o.b)("inlineCode",{parentName:"p"},"personal_question"),", the initiator would send a get request:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-http"},"GET /session_options/personal_question HTTP/1.0\nHost: core:8000\nConnection: close\naccept: */*\naccept-encoding: gzip, deflate, br\naccept-language: en-US,en;q=0.9\n")),Object(o.b)("p",null,"And get a response similar to"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-http"},'HTTP/1.0 200 OK\ncontent-type: application/json\nserver: Rocket\ncontent-length: 288\ndate: Thu, 01 Jul 2021 08:27:43 GMT\n\n{\n    "auth_methods":[\n        {\n            "tag":"irma",\n            "name":"IRMA",\n            "image_path":"/static/irma.svg"\n        },\n        {\n            "tag":"digid",\n            "name":"DigiD",\n            "image_path":"/static/digid.svg"\n        }\n    ],\n    "comm_methods":[\n        {\n            "tag":"call",\n            "name":"Call",\n            "image_path":"/static/phone.svg"\n        },\n        {\n            "tag":"chat",\n            "name":"Chat",\n            "image_path":"/static/chat.svg"\n        }\n    ]\n}\n')),Object(o.b)("p",null,"For an authentication during communication session, the communication plugin can disregard the ",Object(o.b)("inlineCode",{parentName:"p"},"comm_methods")," information provided."),Object(o.b)("h2",{id:"initiating-authentication"},"Initiating authentication"),Object(o.b)("p",null,"Once the end user has chosen the method of authentication, the communication plugin can initiate the authentication using the core's ",Object(o.b)("a",{parentName:"p",href:"../core_api"},Object(o.b)("inlineCode",{parentName:"a"},"start")," endpoint"),". Rather than specifying the communication method as a tag, the communication plugin indicates that it already has a communication session by directly providing a ",Object(o.b)("inlineCode",{parentName:"p"},"comm_url")," at which the communication can be resumed after authentication, and, if desired, a separate ",Object(o.b)("inlineCode",{parentName:"p"},"attr_url")," at which the authentication results should be provided."),Object(o.b)("p",null,"Continuing the above example, assuming the end user has chosen ",Object(o.b)("inlineCode",{parentName:"p"},"irma")," as authentication method, that communication should be resumed at ",Object(o.b)("inlineCode",{parentName:"p"},"https://example.com/chat")," and that the attributes should be sent to ",Object(o.b)("inlineCode",{parentName:"p"},"https://example.com/attributes/a12345"),". Then the communication plugin will make a request similar to"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-http"},'POST /start HTTP/1.0\nHost: core:8000\nConnection: close\nContent-Length: 73\naccept: application/json\ncontent-type: application/json\naccept-encoding: gzip, deflate, br\naccept-language: en-US,en;q=0.9\n\n{\n    "auth_method":"irma",\n    "purpose":"personal_question",\n    "comm_url":"https://example.com/chat",\n    "attr_url":"https://example.com/attributes/a12345"\n}\n')),Object(o.b)("p",null,"and will get a response similar to"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'HTTP/1.0 200 OK\ncontent-type: application/json\nserver: Rocket\ncontent-length: 388\ndate: Thu, 01 Jul 2021 08:31:12 GMT\n\n{\n    "client_url":"https://auth-irma.idcontact.test.tweede.golf/auth/eyJ1IjoiaHR0cHM6Ly9pcm1hLXNlcnZlci5pZGNvbnRhY3QudGVzdC50d2VlZGUuZ29sZi9pcm1hL3Nlc3Npb24vUmdxamZqVHdKNHpmNEJFTzJMZzMiLCJpcm1hcXIiOiJkaXNjbG9zaW5nIn0=/aHR0cHM6Ly93aWRnZXQuY29tbS1tYXRyaXguaWRjb250YWN0LnRlc3QudHdlZWRlLmdvbGYvP3Nlc3Npb249NWUwOTJmNGJmNDIyZDY1OWEyODU5MTVjMGU3Mjk1MWFmODA4MGZkOWVhNDI0YjIwZTgwOWNiMjRiMDI5NWE4Mw=="\n}\n')),Object(o.b)("p",null,"After this, the communication plugin should redirect the end user to the specified ",Object(o.b)("inlineCode",{parentName:"p"},"client_url"),". After authentication has completed the end user will be redirected to ",Object(o.b)("inlineCode",{parentName:"p"},"http://example.com/")," and the plugin will receive the attributes on ",Object(o.b)("inlineCode",{parentName:"p"},"https://example.com/attributes/a12345")," as documented in the ",Object(o.b)("a",{parentName:"p",href:"/comm/overview"},"communication plugin documentation")))}l.isMDXComponent=!0},94:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var i=n(0),a=n.n(i);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=a.a.createContext({}),l=function(e){var t=a.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},h=a.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(n),h=i,d=p["".concat(c,".").concat(h)]||p[h]||m[h]||o;return n?a.a.createElement(d,r(r({ref:t},u),{},{components:n})):a.a.createElement(d,r({ref:t},u))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,c=new Array(o);c[0]=h;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:i,c[1]=r;for(var u=2;u<o;u++)c[u]=n[u];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"}}]);